# Upper Ontology: Domain-Independent Concepts

metadata:
  version: "1.2.0"
  last_updated: "2025-12-02"
  description: "WEM Metadata Ontology including Markets, Physical Capacity, Performance Metrics, WEM Rules, and RCM."

temporal:
  interval_types:
    DispatchInterval:
      duration_minutes: 5
      alignment: "00:00"
    TradingInterval:
      duration_minutes: 30
      alignment: "00:00"
    SCADAInterval:
      duration_seconds: 4
    SettlementPeriod:
      duration_unit: "month"

  conversion_rules:
    - source: DispatchInterval
      target: TradingInterval
      cardinality: many_to_one
      factor: 6
      aggregation: sum
      edge_cases:
        partial: error
        missing: error
      validation: "must_align_on_trading_boundaries"

units:
  Power: MW
  Energy: MWh
  Price: AUD/MWh
  Duration: minutes

unit_validation:
  dispatch_weighted_price:
    inputs:
      quantity: {unit: "MW", type: "power"}
      price: {unit: "AUD/MWh", type: "price_per_energy"}
    output: {unit: "AUD/MWh", type: "price_per_energy"}
    validation: "weighted_average_preserves_price_units"
  
  capacity_factor:
    inputs:
      generation: {unit: "MWh", type: "energy"}
      capacity: {unit: "MW", type: "power"}
      hours: {unit: "h", type: "time"}
    formula: "generation / (capacity * hours)"
    output: {unit: "dimensionless", type: "ratio"}

operations:
  calculate_dispatch_weighted_price:
    required_inputs:
      - dispatch_quantities.quantity
      - dispatch_prices.price
    join_conditions:
      - field: timestamp
        match_type: exact
      - field: market_service
        match_type: exact
    filters:
      - "quantity > 0"
    aggregation:
      formula: "SUM(price * quantity) / SUM(quantity)"
      group_by: [time_period, facility, market_service]
    special_cases:
      storage_facilities:
        rule: "separate_charge_discharge_flows"
        charge_indicator: "quantity < 0"

  calculate_capacity_factor:
    required_inputs:
      - generator_scada.value
      - wikidata.nameplate_capacity
    validation:
      - "nameplate_capacity > 0"
    aggregation:
      formula: "total_generation_mwh / (nameplate_capacity_mw * hours)"
    parameters:
      - name: facility_code
        required: true
      - name: start_time
        required: true
      - name: end_time
        required: true
      - name: cf_type
        required_for: [Storage, Hybrid]
      - name: adjust_for_outages
        default: false
    validation_logic:
      - condition: "facility_type == 'Storage' and cf_type not in ['discharge', 'charge', 'both']"
        error: "Must specify CF type for storage facilities"
      - condition: "facility_type == 'Hybrid' and component not in ['generation', 'storage']"
        error: "Must specify component for hybrid facilities"
      - check: "NameplateCapacity exists in metadata"
      - check: "SCADA coverage >= 80% of period"
    returns:
      - name: capacity_factor
        type: float
      - name: calculation_method
        type: string
      - name: data_completeness
        type: float
      - name: warnings
        type: list

  determine_network_access_quantity:
    description: "Calculates the maximum Capacity Credits a facility can hold based on network constraints."
    required_inputs:
      - CertifiedReserveCapacity
      - RCM_Limit_Advice
      - Dispatch_Scenarios
    parameters:
      - name: facility_code
        required: true
      - name: capacity_year
        required: true
    logic:
      coverage: "Must cover >= 95% of peak dispatch scenarios"
      prioritisation:
        1: "Existing/Committed Facilities"
        2: "Network Augmentation Funding Facilities (NAFF)"
        3: "New Entrants (Class 1 > Class 2 > Class 3)"
    returns:
      - name: network_access_quantity
        type: float
        unit: "MW"

data_quality_rules:
  dispatch_weighted_price:
    minimum_completeness: 0.95
    handling_missing_data: "exclude_intervals"
    flags_to_check:
      - essPreProcessingConditionFlag

aggregation:
  compatibility:
    price:
      - time_weighted_average
      - dispatch_weighted_average
    quantity:
      - sum
      - average

relationships:
  is_a:
    name: "Is A"
    inverse: "has_subtype"
    description: "Indicates that the subject is a subtype of the object (Class-to-Class)."
    category: "Taxonomy"
  instance_of:
    name: "Instance Of"
    inverse: "has_instance"
    description: "Indicates that the subject is an instance of the object Class."
    category: "Taxonomy"
  part_of:
    name: "Part Of"
    inverse: "has_part"
    description: "Indicates that the subject is a component of the object."
    category: "Composition"
  governed_by:
    name: "Governed By"
    inverse: "governs"
    description: "Indicates the regulatory framework controlling the subject."
    category: "Governance"
  related_to:
    name: "Related To"
    description: "Generic semantic association."
    category: "Association"

semantic_context:
  description: "Mappings to public ontologies for domain context."
  references:
    - name: "IEC 61970/61968 Common Information Model (CIM)"
      uri: "https://cimug.ucaiug.org/"
      relevance:
        - "Generators (Generation Package)"
        - "Powerlines/Wires (Wires Package)"
        - "Load Centres (LoadModel)"
        - "Substations and Topology"
    
    - name: "Open Energy Ontology (OEO)"
      uri: "https://openenergy-platform.org/ontology/"
      relevance:
        - "Energy System Modeling"
        - "Physical Energy Assets"
    
    - name: "GeoSPARQL"
      uri: "http://www.opengis.net/ont/geosparql"
      relevance:
        - "Spatial Information"
        - "Geographic Coordinates of Facilities"

    - name: "WEM Rules and Procedures"
      uri: "https://www.wa.gov.au/government/document-collections/wholesale-electricity-market-rules"
      relevance:
        - "Foundational Ontology"
        - "Market Service Definitions (Clauses 3.9.2, 3.9.7)"
        - "Legal and Operational Constraints"

    - name: "Market Surveillance Data Catalogue (MSDC)"
      uri: "https://aemo.com.au/energy-systems/electricity/wholesale-electricity-market-wem/data-wem/market-data-catalogue"
      relevance:
        - "Data Ontology"
        - "Data Dictionary and Taxonomy"
        - "Cross-reference to WEM Rules"
      aliases: ["SentOutData", "SentOut"]

    - name: "WEM Metering, Settlement and Prudential Calculation Formulation"
      uri: "https://aemo.com.au/energy-systems/electricity/wholesale-electricity-market-wem/procedures-policies-and-guides/procedures"
      relevance:
        - "Mathematical Representation"
        - "Logical Hierarchy (Participant -> Facility -> Component)"
        - "Settlement Calculations"

# Physical Capacity
NameplateCapacity:
  name: "Nameplate Capacity"
  definition: "Registered maximum continuous power output (MW)"
  applies_to: [Generator, Storage, Hybrid]
  data_source: "Wikidata, facility registration"
  unit: "MW"
  category: "PhysicalCapacity"

EnergyCapacity:
  name: "Energy Capacity"
  definition: "Total energy storage capacity (MWh)"
  applies_to: [Storage, Hybrid(storage_component)]
  required_for: [EquivalentFullCycles, DurationRating]
  unit: "MWh"
  category: "PhysicalCapacity"

DurationRating:
  name: "Duration Rating"
  definition: "Storage duration at nameplate power (hours)"
  formula: "EnergyCapacity / NameplateCapacity"
  applies_to: [Storage]
  unit: "hours"
  category: "PhysicalCapacity"

SCADA:
  name: "SCADA Telemetry"
  unit: "MW"
  description: "Real-time telemetry from all registered facilities (Generators, Loads, Storage), not just generators."
  category: "Physical"
  aliases: ["generator_scada"]

# Performance Metrics
CapacityFactor:
  name: "Capacity Factor"
  abstract: true
  category: "PerformanceMetric"
  variants:
    GeneratorCapacityFactor:
      name: "Generator Capacity Factor"
      formula: "ActualGeneration / (NameplateCapacity * Hours)"
      applies_to: [Generator(thermal), Generator(renewable)]
      requires: [SCADA]
      valid_range: [0.0, 1.05]
      interpretation: "Fraction of theoretical maximum achieved"
      last_modified: "2025-12-02"
      changes: "Explicitly linked to SCADA."
    StorageDischargeCapacityFactor:
      name: "Storage Discharge Capacity Factor"
      formula: "ActualDischarge / (NameplateCapacity * Hours)"
      applies_to: [Storage]
      interpretation: "Storage utilization for grid injection"
      last_modified: "2025-12-02"
      changes: "Added to support storage analysis."
    StorageChargeCapacityFactor:
      name: "Storage Charge Capacity Factor"
      formula: "ActualCharge / (EnergyCapacity * TimePeriod)"
      applies_to: [Storage]
      interpretation: "Storage utilization for grid withdrawal"
      last_modified: "2025-12-02"
      changes: "Added to support storage analysis."

AvailabilityFactor:
  name: "Availability Factor"
  formula: "(Hours - OutageHours) / Hours"
  applies_to: [All]
  requires: [generator_outages]
  interpretation: "Fraction of time available for dispatch"
  category: "PerformanceMetric"

RoundTripEfficiency:
  name: "Round Trip Efficiency"
  formula: "ActualDischarge / ActualCharge"
  applies_to: [Storage]
  valid_range: [0.7, 0.95]
  time_period: "must match charge/discharge periods"
  interpretation: "Energy retention through charge-discharge cycle"
  category: "PerformanceMetric"

EquivalentFullCycles:
  name: "Equivalent Full Cycles"
  formula: "ActualDischarge / EnergyCapacity"
  applies_to: [Storage]
  requires: [EnergyCapacity]
  interpretation: "Number of complete discharge cycles"
  category: "PerformanceMetric"
